import{i as p}from"./injector-DTwfO8VM.js";import{a as g}from"./index-B9ygI19o.js";const u="ultimos_3_meses",d=e=>e instanceof Date&&!Number.isNaN(e.getTime()),f=e=>{const t=document.querySelectorAll(".media-list .media");if(!t.length)return;const o=new Date;t.forEach(n=>{const s=n.querySelector(".text-fade"),r=s?s.textContent.trim():"",i=r?new Date(r):null;let c=!0;if(d(i))switch(e){case"ultimo_mes":{const a=new Date(o);a.setMonth(o.getMonth()-1),c=i>=a;break}case"ultimos_3_meses":{const a=new Date(o);a.setMonth(o.getMonth()-3),c=i>=a;break}case"ultimos_6_meses":{const a=new Date(o);a.setMonth(o.getMonth()-6),c=i>=a;break}default:c=!0}n.style.display=c?"flex":"none"})},y=(e,t)=>{if(!e||!t)return!1;const o=["protocolo","005","medicamentos","signos_vitales","insumos","saveqx","transanestesico"];let n=0;const s=()=>{if(n>=o.length)return;const r=o[n],i=`/reports/protocolo/pdf?form_id=${encodeURIComponent(e)}&hc_number=${encodeURIComponent(t)}&modo=separado&pagina=${encodeURIComponent(r)}`,c=window.open(i,"_blank"),a=r==="transanestesico"?9e3:2500;window.setTimeout(()=>{c?.close(),n+=1,window.setTimeout(s,300)},a)};return s(),!1},h=e=>{if(!e)return[];if(Array.isArray(e))return e;try{return JSON.parse(e)}catch(t){return console.warn("No se pudo parsear la lista de diagnósticos",t),[]}},E=e=>e.length?e.map((t,o)=>{const n=t?.idDiagnostico??"N/A",s=t?.ojo??"—";return`${o+1}. ${n} (${s})`}).join("<br>"):"—",w=e=>{if(!e)return"—";const t=new Date(e);return d(t)?t.toLocaleDateString("es-EC"):e},D=(e,t)=>{const o=document.getElementById("modalSemaforo");if(!o)return;let n="gray";if(e?.toLowerCase()==="recibido"&&t){const s=new Date(t),r=new Date;if(d(s)){const i=Math.floor((r-s)/864e5);i>14?n="red":i>7?n="yellow":n="green"}}o.style.backgroundColor=n},C=()=>{typeof window>"u"||(window.filterDocuments=e=>f(e??u),window.descargarPDFsSeparados=y)},I=e=>{typeof document>"u"||(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e())},x=async(e,t)=>{const{data:o}=await g.get(`/api/pacientes/${encodeURIComponent(e)}/solicitudes/${encodeURIComponent(t)}`);return o},_=e=>{const t=document.getElementById("modalFecha");t&&(t.textContent=w(e?.fecha));const o=document.getElementById("modalProcedimiento");o&&(o.textContent=e?.procedimiento??"—");const n=document.getElementById("modalDiagnostico");n&&(n.innerHTML=E(h(e?.diagnosticos)));const s=document.getElementById("modalDoctor");s&&(s.textContent=e?.doctor??"—");const r=document.getElementById("modalDescripcion");r&&(r.textContent=e?.plan??"—");const i=document.getElementById("modalOjo");i&&(i.textContent=e?.ojo??"—");const c=document.getElementById("modalEstado");c&&(c.textContent=e?.estado??"—");const a=document.getElementById("modalMotivo");a&&(a.textContent=e?.motivo_consulta??"—");const l=document.getElementById("modalEnfermedad");l&&(l.textContent=e?.enfermedad_actual??"—"),D(e?.estado??"",e?.fecha??"")},M=()=>{C(),I(()=>{f(u);const e=document.getElementById("modalSolicitud");e&&e.addEventListener("show.bs.modal",async t=>{const o=t.relatedTarget;if(!o)return;const n=o.getAttribute("data-hc"),s=o.getAttribute("data-form-id");if(!(!n||!s))try{const r=await x(n,s);_(r)}catch(r){console.error("No se pudo cargar los detalles de la solicitud",r)}})})},m=["assets/vendor_components/apexcharts-bundle/dist/apexcharts.js","assets/vendor_components/horizontal-timeline/js/horizontal-timeline.js"];M();typeof document<"u"&&p(m).then(()=>{document.dispatchEvent(new CustomEvent("legacy:pacientes:scripts-ready",{detail:m}))}).catch(e=>console.error(e));
